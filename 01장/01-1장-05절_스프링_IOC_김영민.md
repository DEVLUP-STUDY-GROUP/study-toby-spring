# 1.5 스프링의 IoC

- 스프링의 핵심을 담당하는 것은 바로 `빈 팩토리` 또는 `애플리케이션 컨텍스트`
- 위 두 가지는 DaoFactory가 하는 일을 일반화 한 것이라 볼 수 있음

## 1.5.1 오브젝트 팩토리를 이용한 스프링 IoC

- DaoFactory를 스프링에서 사용 가능하도록 변경 해보자
- `bean`
  - 스프링이 제어권을 가지고 직접 만들고 관계를 부여하는 오브젝트
  - 즉, 스프링 IoC 컨테이너에 의해 관리가 되는 bean을 의미

## DaoFactory를 사용하는 애플리케이션 컨텍스트

- 스프링이 빈 팩토리를 위한 오브젝트 설정을 담당하는 클래스라 인식이 가능 하도록 @Configuration 어노테이션 등록
- 메서드에는 @Bean 어노테이션 추가
- DaoFactory를 설정정보로 사용하는 Application Context는 다음과 같다 

```java
@Configuration
public class DaoFactory {

    @Bean
    public UserDao userDao() {
        return new UserDao(connectionMaker());
    }

    @Bean
    public ConnectionMaker connectionMaker() {
        return new DConnectionMaker();
    }
}
```

```java
public class UserDaoTest {
    public static void main(String[] args/) throws ClassNotFoundException, SQLException {
        ApplicationContext ac = new AnnotationConfigApplicationContext(DaoFactory.class); // DaoFactory.class를 기반으로
        UserDao dao = ac.getBean("userDao", UserDao.class); // UserDao bean을 찾아서 주세요
    }
}
```

- getBean : ac가 관리하는 오브젝트를 요청하는 메서드
- ac.getBean("userDao") : userDao라는 함수명을 가진 Bean을 반환
- ac.getBean("userDao", UserDao.class) : getBean() 함수는 항상 Object를 반환하기에 원하는 리턴 타입을 지정하여 Casting을 방지 한다

## 1.5.2 애플리케이션 컨텍스트의 동작 방식

![애플리케이션 컨텍스트 동작 방식](./img/05.png)

> application context를 스프링 컨테이너라 할 수 있음  
> Bean Life cycle과 관련이 있음

- Application Context는 DaoFactory 클래스를 설정정보로 등록해둔다
- @Bean이 붙은 메서드의 이름을 가져오 빈 목록을 만들어 둔다
- 사용자가 getBean 요청 시 빈 목옥에서 조건에 맞는 Bean 반환

✅ 클라이언트는 구체적인 팩토리 클래스를 알 필요가 없음

- 애플리케이션이 발전하면 DaoFactory처럼 IoC를 적용한 오브젝트도 계속 추가될 것이다
- 클라이언트는 어떤 팩토리 클래스를 사용할지 알아야함, 필요할때마다 팩토리 클래스 생성도 필요하다
- `애플리케이션 컨텍스트를 사용하면 일관된 방식으로 오브젝트를 가져올 수 있음`


✅ 애플리케이션 컨텍스트는 종합 IoC 서비스를 제공해준다

- AC의 역할은 단지 오브젝트 생성과 다른 오브젝트와의 관계설정만이 전부가 아님
- 오브젝트가 만들어지는 방식, 시점과 전략을 다르게 가져갈 수 있음
- 자동생성, 오브젝트의 후처리, 정보 조합, 인터셉팅 등 제공

✅ 애플리케이션 컨텍스트는 빈을 검색하는 다양한 방법을 제공

```java
 ApplicationContext ac = new AnnotationConfigApplicationContext(DaoFactory.class);
UserDao dao = ac.getBean("userDao", UserDao.class);
```

- AC의 getBean() 메서드는 빈 이름을 통해 빈을 찾아준다
- 타입만으로 빈을 검색하거나, 애노테이션 설정이 되있는 빈을 찾을수도 있음

## 1.5.3 스프링 IoC의 용어 정리

> IoC 관련 용어 정리

## 빈(Bean)

- 스프링이 IoC 방식으로 관리하는 오브젝트
- IoC 컨테이너에 의해 관리되는 오브젝트라고도 함
- 스프링의 모든 객체가 다 스프링 빈이라고 할수는 없음
  - @Configuration + @Bean
  - @ComponentScan
- 스프링이 직접 그 생성과 제어를 담당하는 오브젝트만 빈이라 지칭함 

## 빈 팩토리(Bean Factory)

- 스프링의 IoC를 담당하는 `핵심 컨테이너`
- 빈을 `등록`하고 `관리`하는 기능 제공
- BeanFactory 말고 ApplicationContext 구현 클래스를 주로 사용
- BeanFactory 인터페이스 안에 getBean() 메서드가 정의되어 있음
- 빈 팩토리는 주로 빈의 생성과 제어의 관점에서 야기

## 애플리케이션 컨텍스트(Application Context)

- 빈 팩토리 `확장 IoC 컨테이너`
- 빈을 `등록`하고 `관리`하는 기능 제공 ( BeanFactory와 동일 )
- 스프링이 제공하는 각종 부가 서비스 추가 제공
- 애플리케이션 컨텍스트는 스프링이 제공하는 애플리케이션 지원 기능을 포함해서 야기

## 설정정보/설정 메타정보

- `ApplicationContext` 또는 `BeanFactory`가 `Ioc`를 `적용`하기 위해 사용하는 `메타정보`

## 컨테이너 또는 IoC 컨테이너

- `IoC 방식으로 빈을 관리`한다는 의미에서 AC나 BeanFactory를 IoC 컨테이너라 지칭