# 2장 테스트

## 2.5 학습 테스트로 배우는 스프링

- 학습 테스트(learning test)
    - 자신이 만들지 않은 프레임워크나 다른 개발팀에서 만들어서 제공한 라이브러리 등에 대해서도 테스트 작성
    - 목적
        - 자신이 사용할 API나 프레임워크의 기능을 테스트로 보면서 사용 방법을 익히는 것
        - 자신이 테스트를 만들려고 하는 기술이나 기능에 대해 얼마나 제대로 이해하고 있는지, 사용 방법을 바로 알고 있는지를 검증
        - 테스트 코드를 작성해보면서 빠르고 정확하게 사용법을 익히는 것
    - 테스트 코드를 만드는 과정을 통해 API의 사용 방법도 익히고 내가 가진 기술에 대한 지식도 검증 가능
    - 학습 테스트는 테스트 대상보다는 테스트 코드 자체에 관심을 갖고 만듦

### 2.5.1 학습 테스트의 장점

- 다양한 조건에 따른 기능을 손쉽게 확인
    - 자동화된 테스트의 모든 장점이 학습 테스트에도 그대로 적용, 예제를 만들면서 학습하는 것은 수동 테스트와 성격이 비슷
    - 자동화된 테스트 코드를 만들어지기 때문에 다양한 조건에 따라 기능이 어떻게 동작하는지 빠르게 확인 가능
- 학습 테스트 코드를 개발중에 참고 가능
    - 수동으로 예제를 만드는 방법은 코드를 계속 수정해가면서 기능을 확인 최종 수정한 예제 코드만 남아 있음
    - 학습 테스트는 다양한 기능과 조건에 대한 테스트 코드를 개별적을 만들고 남겨둘 수 있음
    - 테스트로 새로운 기술의 다양한 기능을 사용하는 코드를 만들어두면 실제 개발에서 샘플 코드로 참고 가능
    - 새로운 프레임워크나 기술 사용 시 학습 테스트를 만들면서 사용법을 익히고, 애플리케이션 테스트 패키지의 일부로 추가
        - 개발자들이 필요 시, 언제든지 학습 테스트로 만들었떤 코드를 참고 가능
- 프레임워크나 제품을 업그레이드 할 떄 호환성 검증
    - 새로운 버전으로 업그레이드 시, API 사용법에 미묘한 변화가 생기거나, 기존에는 잘 동작하던 기능에 문제 발생 가능
    - 기존에 사용햇떤 API나 기능에 변화가 있거나 업데이트 된 제품에 버그가 있다면, 학습 테스트를 통해 미리 확인 가능
- 테스트 작성에 대한 좋은 훈련이 됨
    - 개발자가 테스트를 작성하는데 충분히 훈련되어 있지 않거나 부담을 갖고 있다면, 먼저 학습 테스트를 작성해보면서 테스트 코드 작성을 연습 가능
    - 프레임워크의 학습 테스트는 실제로 프레임워크를 사용하는 애플리케이션 코드의 테스트와 비슷하게 만들어짐
    - 한두 가지 간단한 기능에만 초점을 맞추면 되기 때문에 테스트도 다체로 단순함
    - 애플리케이션 개발 중에 작성하는 테스트보다는 한결 작성하기 수월하고 부담도 적음
    - 학습 테스트를 테스트 작성의 훈련 기회로 삼는 것도 좋음, 새로운 테스트 방법을 연구하는 데도 도움이 됨
    - 테스트가 까다로운 기술은 먼저 학습 테스트를 만들어보면서 간결한 테스트 작성 방법을 연구하면 도움이 됨
- 새로운 기술을 공부하는 과정이 즐거워짐
    - 책이나 레퍼런스 문서 등을 읽기만 하는 공부는 쉽게 지루해짐, 지루함은 학습의 능률도 떨어뜨림
    - 테스트 코드를 만들면서 하는 학습은 흐임롭고 재미있음
    - 즐겁게 학습한 것은 지루함을 참으며 억지로 했을 때보다 훨씬 오래 기억에 남음
- 새로운 프레임워크나 기술을 전반적으로 공부하는 과정에서도 유용
- 스프링 학습 테스트를 만들 때 참고할 수 있는 가장 좋은 소스는 스프링 자신에 대한 테스트 코드
    - 스프링은 꼼꼼하게 테스트를 만들어져가며 개발해온 프레임워크, 거의 모든 기능에 대한 방대한 양의 테스트가 만들어져 있음
    - 테스트 방법에 대한 좋은 팁도 알 수 있음

### 2.5.2 학습 테스트 예제

- `hasItem()`: 컬렉션의 원소인지 검사하는 메소드
- JUnit과는 반대로 스프링의 테스트용 애플리케이션 컨텍스트는 테스트 개수에 상관없이 한개만 만들어짐
    - 만들어진 컨텍스트는 모든 테스트에서 공유
- `assertThat()`: 매처와 비교할 대상인 첫 번재 파라미터에 Boolean 타입의 결과가 나오는 조건문을 넣는 메소드
- 학습 테스트는 같은 기능이지만 다른 방법으로 사용하는 코드를 만들어서 비교하는데도 유용
- 실전에 적용하기 전에 스프링의 기능을사용한 테스트를 가능한 많이 만들어보는 것이 좋음

### 2.5.3 버그 테스트

- 버그 테스트(bug test): 코드에 오류가 있을 때 그 오류를 가장 잘 드러내줄 수 있는 테스트
- 버그 발견 시, 무턱대고 코드를 뒤져가면서 수정하려고 하기보다는 먼저 버그 테스트를 만들어보는 편이 유용
- 버그 테스트는 일단 실패하도록 만들어야 함
    - 버그가 원인이 되서 테스트가 실패하는 코드를 만듦
    - 이후 버그 테스트가 성공할 수 있도록 애플리케이션 코드를 수정 → 테스트가 성공 시, 버그는 해결 됨
- 버그 테스트의 필요성과 장점
    - 테스트의 완성도를 높여줌
        - 기존 테스트에서 검증하지 못했던 부분이 있기 때문에 오류 발생 → 이를 테스트를 만들면 불충분했던 테스트를 보완
        - 이후에 비슷한 문제가 다시 등장하더라도 이전에 만들었던 버그 테스트 덕분에 쉽게 추척 가능
    - 버그의 내용을 명확하게 분석
        - 버그가 있을 때 그것을 테스트로 만들어서 실패하게 하려면 어떤 이유 때문에 문제가 생겼는지 명확히 알야 함
        - 버거를 좀 더 효과적으로 분석 가능 → 그 과정에서 그 버그로 인해 발생할 수 있는 다른 오류도 함께 발견 가능
        - 테스트의 중요한 기법 중 하나인 동등분할이나 경계값 분석을 적용 가능
    - 기술적인 문제를 해결하는데 도움이 됨
        - 코드와 설정 등을 살펴봐도 별다른 문제가 없는 것 같이 느껴지거나 기술적으로 다루기 힘든 버그를 발견한 경우
        - 동일 문제가 발생하는 가장 단순한 코드와 그에 대한 버그 테스트르 만들어봄 도움이 됨
        - 외부의 전문가나 포럼, 메일링 리스트 등 커뮤니티의 도움을 받을 때도 도움이 됨
- 동등분할(equivalence partitioning)
    - 같은 결과를 내는 값의 범위를 구분해서 각 대표 갑승로 테스트를 하는 방법
    - 각 결과를 내는 입력 값이나 상황 조합을 만들어 모든 경우에 대한 테스트를 해보는 것이 좋음
- 경계값 분석(boundary value analysis)
    - 에러는 동등분할 범위의 경계에서 주로 많이 발생한다는 특징을 이용해 경계의 근처에 있는 값을 이용해 테스트하는 방법
    - 보통 숫자 입력 값인 경우 0이나 그 주변 값 또는 정수의 최대값 최소값 등으로 테스트 해보면 도움이 될 때가 많음

### 2.6 정리

- 테스트는 자동화돼야 하고, 빠르게 실행할 수 있어야 함
- main() 테스트 대신 JUnit 프레임워크를 이용한 테스트 작성이 편리
- 테스트 결과는 일관성이 있어야 함, 코드의 변경 없이 환경이나 테스트 실행 순서에 따라서 결과가 달라지면 안됨
- 테스트는 포괄적으로 작성, 충분한 검증을 하지 않는 테스트는 없는 것보다 나쁠 수 있음
- 코드 작성과 테스트 수행의 간격이 짧을수록 효과적임
- **테스트하기 쉬운 코드가 좋은 코드**
- 테스트를 먼저 만들고 테스트를 성공시키는 코드를 만들어가는 테스트 주도 개발 방법도 유용
- 테스트 코드도 애플리케이션 코드와 마찬가지로 적절한 리팩토링이 필요
- `@Before, @After`를 사용해서 테스트 메소드들의 공통 준비 작업과 정리 작업을 처리 가능
- 스프링 테스트 컨텍스트 프레임워크를 이용하면 테스트 성능을 향상
- 동일한 설정파일을 사용하는 테스트는 하나의 애플리케이션 컨텍스트를 공유
- `@Autowired`를 사용하면 컨텍스트의 빈을 테스트 오브젝트에 DI 가능
- 기술의 사용 방법을 익히고 이해를 돕기 위해 학습 테스트를 작성
- 오류가 발견될 경우, 그에 대한 버그 테스트를 만들어두면 유용함
- 스프링을 사용하는 개발자라면 자신이 만든 코드를 테스트로 검증하는 방법을 알고, 테스트를 개발에 적극적으로 활용할 수 있어야 함